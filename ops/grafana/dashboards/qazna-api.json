{
  "uid": "qazna-api",
  "title": "Qazna API",
  "timezone": "browser",
  "schemaVersion": 39,
  "version": 1,
  "editable": true,
  "style": "dark",
  "time": { "from": "now-15m", "to": "now" },
  "refresh": "5s",
  "panels": [
    {
      "type": "stat",
      "title": "Build info",
      "gridPos": { "x": 0, "y": 0, "w": 6, "h": 4 },
      "targets": [
        { "expr": "build_info", "refId": "A" }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"], "fields": "", "values": false },
        "orientation": "auto",
        "textMode": "value_and_name"
      },
      "fieldConfig": {
        "defaults": { "mappings": [], "thresholds": { "mode": "absolute", "steps": [ { "color": "green", "value": null } ] } },
        "overrides": []
      }
    },
    {
      "type": "stat",
      "title": "Readiness",
      "gridPos": { "x": 6, "y": 0, "w": 6, "h": 4 },
      "targets": [
        { "expr": "max(qazna_ready)", "refId": "A" }
      ],
      "options": {
        "reduceOptions": { "calcs": ["lastNotNull"] },
        "colorMode": "value",
        "textMode": "auto",
        "graphMode": "none"
      },
      "fieldConfig": {
        "defaults": {
          "mappings": [
            { "type": "value", "options": { "0": { "text": "not ready", "color": "red" }, "1": { "text": "ready", "color": "green" } } }
          ],
          "thresholds": { "mode": "absolute", "steps": [ { "color": "red", "value": null }, { "color": "green", "value": 1 } ] }
        },
        "overrides": []
      }
    },
    {
      "type": "timeseries",
      "title": "RPS by path",
      "gridPos": { "x": 12, "y": 0, "w": 12, "h": 8 },
      "targets": [
        { "expr": "sum by (path,method) (rate(http_requests_total[1m]))", "legendFormat": "{{method}} {{path}}", "refId": "A" }
      ],
      "fieldConfig": { "defaults": { "unit": "req/s" }, "overrides": [] },
      "options": { "legend": { "showLegend": true }, "tooltip": { "mode": "multi" } }
    },
    {
      "type": "timeseries",
      "title": "Latency p50 / p90 / p99 (s)",
      "gridPos": { "x": 0, "y": 4, "w": 12, "h": 8 },
      "targets": [
        { "expr": "histogram_quantile(0.5,  sum by (le) (rate(http_request_duration_seconds_bucket[5m])))", "legendFormat": "p50", "refId": "A" },
        { "expr": "histogram_quantile(0.9,  sum by (le) (rate(http_request_duration_seconds_bucket[5m])))", "legendFormat": "p90", "refId": "B" },
        { "expr": "histogram_quantile(0.99, sum by (le) (rate(http_request_duration_seconds_bucket[5m])))", "legendFormat": "p99", "refId": "C" }
      ],
      "fieldConfig": { "defaults": { "unit": "s" }, "overrides": [] },
      "options": { "legend": { "showLegend": true }, "tooltip": { "mode": "multi" } }
    },
    {
      "type": "timeseries",
      "title": "5xx error rate (rps)",
      "gridPos": { "x": 0, "y": 12, "w": 12, "h": 8 },
      "targets": [
        { "expr": "sum by (path,method) (rate(http_requests_total{status=~\"5..\"}[5m]))", "legendFormat": "{{method}} {{path}}", "refId": "A" }
      ],
      "fieldConfig": { "defaults": { "unit": "req/s" }, "overrides": [] },
      "options": { "legend": { "showLegend": true }, "tooltip": { "mode": "multi" } }
    },
    {
      "type": "timeseries",
      "title": "Inflight requests",
      "gridPos": { "x": 12, "y": 8, "w": 12, "h": 6 },
      "targets": [
        { "expr": "sum(http_inflight_requests)", "legendFormat": "inflight", "refId": "A" }
      ],
      "fieldConfig": { "defaults": { "unit": "none" }, "overrides": [] }
    },
    {
      "type": "timeseries",
      "title": "Go runtime (goroutines / GC pauses)",
      "gridPos": { "x": 12, "y": 14, "w": 12, "h": 6 },
      "targets": [
        { "expr": "go_goroutines", "legendFormat": "goroutines", "refId": "A" },
        { "expr": "rate(go_gc_duration_seconds_sum[5m])", "legendFormat": "gc_pause_rate", "refId": "B" }
      ],
      "fieldConfig": { "defaults": {}, "overrides": [] }
    }
  ],
  "templating": {
    "list": [
      {
        "name": "path",
        "type": "query",
        "datasource": "Prometheus",
        "query": "label_values(http_requests_total, path)",
        "includeAll": true,
        "refresh": 1,
        "multi": true
      }
    ]
  }
}
